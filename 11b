import java.io.*; 
import java.nio.file.*; 
import java.security.*; 
import java.util.*; 
 
public class RootkitHunter { 
    // Example "known bad" hashes (replace with actual SHA-256 hashes). 
    private static final Set<String> KNOWN_BAD_HASHES = new HashSet<>(Arrays.asList( 
        "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa", 
        "bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb" 
    )); 
 
    public static void main(String[] args) { 
        if (args.length != 1) { 
            System.out.println("Usage: java Cv <path-to-scan>"); 
            System.exit(1); 
        } 
 
        Path start = Paths.get(args[0]); 
        if (!Files.exists(start)) { 
            System.out.println("Path does not exist: " + start); 
            System.exit(1); 
        } 
 
        List<Path> flagged = new ArrayList<>(); 
        List<Path> scanned = new ArrayList<>(); 
 
        try { 
            Files.walk(start) 
                .filter(Files::isRegularFile) 
                .forEach(path -> { 
                    try { 
                        String hash = sha256(path); 
                        scanned.add(path); 
                        if (KNOWN_BAD_HASHES.contains(hash)) { 
                            flagged.add(path); 
                            System.out.printf("FLAGGED: %s (sha256=%s)%n", path, hash); 
                        } else { 
                            System.out.printf("OK: %s (sha256=%s)%n", path, hash); 
                        } 
                    } catch (IOException | NoSuchAlgorithmException e) { 
                        System.err.println("Error reading " + path + ": " + e.getMessage()); 
                    } 
                }); 
        } catch (IOException e) { 
            System.err.println("Error walking path: " + e.getMessage()); 
            System.exit(2); 
        } 
 
        System.out.println("\nScan complete."); 
        System.out.println("Files scanned: " + scanned.size()); 
        System.out.println("Files flagged: " + flagged.size()); 
 
        if (!flagged.isEmpty()) { 
            System.out.println("Flagged files:"); 
            flagged.forEach(p -> System.out.println(" - " + p)); 
        } 
    } 
 
    private static String sha256(Path path) throws IOException, NoSuchAlgorithmException { 
        MessageDigest digest = MessageDigest.getInstance("SHA-256"); 
 
        try (InputStream is = Files.newInputStream(path); 
             BufferedInputStream bis = new BufferedInputStream(is)) { 
            byte[] buffer = new byte[8192]; 
            int read; 
            while ((read = bis.read(buffer)) != -1) { 
                digest.update(buffer, 0, read); 
            } 
        } 
 
        byte[] hashed = digest.digest(); 
        return bytesToHex(hashed); 
    } 
 
    private static String bytesToHex(byte[] bytes) { 
        StringBuilder sb = new StringBuilder(bytes.length * 2); 
        for (byte b : bytes) { 
            sb.append(String.format("%02x", b & 0xff)); 
        } 
        return sb.toString(); 
    } 
}
